#:kivy 2.3.0
#:import MDBoxLayout kivymd.uix.boxlayout.MDBoxLayout
#:import MDLabel kivymd.uix.label.MDLabel
#:import MDTextField kivymd.uix.textfield.MDTextField
#:import MDRectangleFlatButton kivymd.uix.button.MDRectangleFlatButton
#:import MDCard kivymd.uix.card.MDCard
#:import MDRaisedButton kivymd.uix.button.MDRaisedButton

<HomeScreen>:
    ScrollView:
        MDBoxLayout:
            orientation: "vertical"
            padding: "16dp"
            spacing: "18dp"
            size_hint_y: None
            height: self.minimum_height

            # --- SECCIÓN: Balance y Filtros ---
            MDCard:
                orientation: "vertical"
                padding: "18dp"
                spacing: "10dp"
                size_hint_y: None
                height: self.minimum_height
                elevation: 6
                radius: [18, 18, 18, 18]

                MDBoxLayout:
                    orientation: "horizontal"
                    size_hint_y: None
                    height: "36dp"
                    spacing: "12dp"
                    padding: "0dp", "0dp", "0dp", "0dp"

                    MDLabel:
                        text: "Balance mensual"
                        font_style: "H6"
                        halign: "right"
                        theme_text_color: "Primary"
                        size_hint_x: 0.55

                    MDLabel:
                        id: balance_lbl
                        text: "$0"
                        font_style: "H6"
                        halign: "left"
                        theme_text_color: "Secondary"
                        size_hint_x: 0.45

                MDBoxLayout:
                    size_hint_y: None
                    height: "48dp"
                    spacing: "10dp"
                    padding: "0dp", "8dp"

                    Spinner:
                        id: filtro_categoria
                        text: "Todas"
                        values: ["Todas"]
                        on_text: root.filtrar()
                        background_color: 0.25, 0.32, 0.71, 1  # Azul suave
                        color: 1, 1, 1, 1  # Texto blanco

                    Spinner:
                        id: filtro_mes
                        text: "Todos"
                        values: ["Todos"]
                        on_text: root.filtrar()
                        background_color: 0.25, 0.32, 0.71, 1  # Azul suave
                        color: 1, 1, 1, 1  # Texto blanco

                    MDRectangleFlatButton:
                        text: "Limpiar"
                        on_release: root.limpiar_filtros()

            Widget:
                size_hint_y: None
                height: "10dp"

            # --- SECCIÓN: Transacciones ---
            MDCard:
                orientation: "vertical"
                padding: "16dp"
                spacing: "8dp"
                size_hint_y: None
                height: self.minimum_height
                elevation: 4
                radius: [14, 14, 14, 14]

                MDLabel:
                    text: "Transacciones"
                    font_style: "H6"
                    halign: "center"
                    theme_text_color: "Primary"
                    size_hint_y: None
                    height: "28dp"

                MDList:
                    id: transacciones_list

            Widget:
                size_hint_y: None
                height: "10dp"

            # --- SECCIÓN: Presupuestos ---
            MDCard:
                orientation: "vertical"
                padding: "16dp"
                spacing: "8dp"
                size_hint_y: None
                height: self.minimum_height
                elevation: 4
                radius: [14, 14, 14, 14]

                MDLabel:
                    text: "Presupuestos activos"
                    font_style: "H6"
                    halign: "center"
                    theme_text_color: "Primary"
                    size_hint_y: None
                    height: "28dp"

                MDList:
                    id: presupuestos_list

            Widget:
                size_hint_y: None
                height: "10dp"

            # --- SECCIÓN: Acciones y Alertas ---
            MDCard:
                orientation: "vertical"
                padding: "14dp"
                spacing: "8dp"
                size_hint_y: None
                height: self.minimum_height
                elevation: 2
                radius: [10, 10, 10, 10]

                # Primera fila de botones
                MDBoxLayout:
                    orientation: "horizontal"
                    spacing: "8dp"
                    size_hint_y: None
                    height: "48dp"

                    MDRaisedButton:
                        text: "+ Nueva transacción"
                        icon: "plus"
                        md_bg_color: app.theme_cls.primary_color
                        text_color: 1,1,1,1
                        on_release: app.root.current = "add_tx"
                        size_hint_x: 1

                    MDRaisedButton:
                        text: "Ver gráficos"
                        icon: "chart-bar"
                        md_bg_color: 0.25, 0.32, 0.71, 1
                        text_color: 1,1,1,1
                        on_release: app.root.current = "graphics"
                        size_hint_x: 1

                # Segunda fila de botones
                MDBoxLayout:
                    orientation: "horizontal"
                    spacing: "8dp"
                    size_hint_y: None
                    height: "48dp"

                    MDRaisedButton:
                        text: "Exportar a Excel"
                        icon: "file-excel"
                        md_bg_color: 0.13, 0.55, 0.13, 1
                        text_color: 1,1,1,1
                        on_release: root.exportar_excel()
                        size_hint_x: 1

                    MDRaisedButton:
                        text: "Definir presupuesto"
                        icon: "wallet"
                        md_bg_color: 0.91, 0.49, 0.13, 1
                        text_color: 1,1,1,1
                        on_release: root.popup_presupuesto()
                        size_hint_x: 1

                # Tercera fila de botones
                MDBoxLayout:
                    orientation: "horizontal"
                    spacing: "8dp"
                    size_hint_y: None
                    height: "48dp"

                    MDRaisedButton:
                        text: "Cambiar Tema"
                        icon: "theme-light-dark"
                        md_bg_color: 0.5, 0.5, 0.5, 1
                        text_color: 1,1,1,1
                        on_release: app.toggle_theme()
                        size_hint_x: 1

                    MDRaisedButton:
                        text: "Cerrar sesión"
                        icon: "logout"
                        md_bg_color: 0.8, 0.2, 0.2, 1
                        text_color: 1,1,1,1
                        on_release: app.root.current = "login"
                        size_hint_x: 1

                MDLabel:
                    id: alerta_lbl
                    text: ""
                    markup: True
                    font_style: "Subtitle2"
                    halign: "center"
                    theme_text_color: "Error"